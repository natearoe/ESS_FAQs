<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Components | NRCS Ecologist FAQs</title>
  <meta name="description" content="This is a compilation of FAQs for NRCS Ecologists." />
  <meta name="generator" content="bookdown 0.32 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Components | NRCS Ecologist FAQs" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a compilation of FAQs for NRCS Ecologists." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Components | NRCS Ecologist FAQs" />
  
  <meta name="twitter:description" content="This is a compilation of FAQs for NRCS Ecologists." />
  

<meta name="author" content="Nathan Roe - nateroe@gmail.com" />


<meta name="date" content="2023-02-06" />

  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="mapunits.html"/>
<link rel="next" href="ecosites.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>
<script src="libs/htmlwidgets-1.6.1/htmlwidgets.js"></script>
<link href="libs/leaflet-1.3.1/leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-1.3.1/leaflet.js"></script>
<link href="libs/leafletfix-1.0.0/leafletfix.css" rel="stylesheet" />
<script src="libs/proj4-2.6.2/proj4.min.js"></script>
<script src="libs/Proj4Leaflet-1.0.1/proj4leaflet.js"></script>
<link href="libs/rstudio_leaflet-1.3.1/rstudio_leaflet.css" rel="stylesheet" />
<script src="libs/leaflet-binding-2.1.1/leaflet.js"></script>
<script src="libs/leaflet-providers-1.9.0/leaflet-providers_1.9.0.js"></script>
<script src="libs/leaflet-providers-plugin-2.1.1/leaflet-providers-plugin.js"></script>
<link href="libs/HomeButton-0.0.1/home-button.css" rel="stylesheet" />
<script src="libs/HomeButton-0.0.1/home-button.js"></script>
<script src="libs/HomeButton-0.0.1/easy-button-src.min.js"></script>
<script src="libs/clipboard-0.0.1/setClipboardText.js"></script>
<link href="libs/mapviewCSS-0.0.1/mapview-popup.css" rel="stylesheet" />
<link href="libs/mapviewCSS-0.0.1/mapview.css" rel="stylesheet" />


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ESS FAQs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#odbc-connection"><i class="fa fa-check"></i><b>1.2</b> ODBC Connection</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#standard"><i class="fa fa-check"></i><b>1.3</b> Standard dataset/packages</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mapunits.html"><a href="mapunits.html"><i class="fa fa-check"></i><b>2</b> Mapunits</a>
<ul>
<li class="chapter" data-level="2.1" data-path="mapunits.html"><a href="mapunits.html#mapunitsinMLRA"><i class="fa fa-check"></i><b>2.1</b> What mapunits are in an MLRA?</a></li>
<li class="chapter" data-level="2.2" data-path="mapunits.html"><a href="mapunits.html#mapunitsinSSA"><i class="fa fa-check"></i><b>2.2</b> What mapunits are in a Soil Survey Area?</a></li>
<li class="chapter" data-level="2.3" data-path="mapunits.html"><a href="mapunits.html#mapping-mapunits"><i class="fa fa-check"></i><b>2.3</b> Mapping mapunits</a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>3</b> Components</a>
<ul>
<li class="chapter" data-level="3.1" data-path="components.html"><a href="components.html#componentsinMLRA"><i class="fa fa-check"></i><b>3.1</b> Identify components in MLRA?</a></li>
<li class="chapter" data-level="3.2" data-path="components.html"><a href="components.html#identify-components-in-soil-survey-area"><i class="fa fa-check"></i><b>3.2</b> Identify components in Soil Survey Area?</a></li>
<li class="chapter" data-level="3.3" data-path="components.html"><a href="components.html#existing-component-ecosite-correlations"><i class="fa fa-check"></i><b>3.3</b> Existing component, ecosite correlations</a></li>
<li class="chapter" data-level="3.4" data-path="components.html"><a href="components.html#components-correlated-to-an-ecosite-of-interest"><i class="fa fa-check"></i><b>3.4</b> Components correlated to an ecosite of interest?</a></li>
<li class="chapter" data-level="3.5" data-path="components.html"><a href="components.html#ecological-characteristics-of-components-non-programmatic"><i class="fa fa-check"></i><b>3.5</b> Ecological characteristics of components? (non-programmatic)</a></li>
<li class="chapter" data-level="3.6" data-path="components.html"><a href="components.html#ecological-characteristics-of-components-programmatic"><i class="fa fa-check"></i><b>3.6</b> Ecological characteristics of components? (programmatic)</a></li>
<li class="chapter" data-level="3.7" data-path="components.html"><a href="components.html#where-do-components-occur"><i class="fa fa-check"></i><b>3.7</b> Where do components occur?</a></li>
<li class="chapter" data-level="3.8" data-path="components.html"><a href="components.html#how-to-correlate-components-to-ecosites"><i class="fa fa-check"></i><b>3.8</b> How to correlate components to ecosites?</a></li>
<li class="chapter" data-level="3.9" data-path="components.html"><a href="components.html#how-to-qc-the-correlation-between"><i class="fa fa-check"></i><b>3.9</b> How to QC the correlation between</a></li>
<li class="chapter" data-level="3.10" data-path="components.html"><a href="components.html#test-section"><i class="fa fa-check"></i><b>3.10</b> Test section</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ecosites.html"><a href="ecosites.html"><i class="fa fa-check"></i><b>4</b> Ecosites</a>
<ul>
<li class="chapter" data-level="4.1" data-path="ecosites.html"><a href="ecosites.html#what-ecosites-are-active-in-an-mlra"><i class="fa fa-check"></i><b>4.1</b> What ecosites are active in an MLRA?</a></li>
<li class="chapter" data-level="4.2" data-path="ecosites.html"><a href="ecosites.html#range-in-characteristics-of-ecosites"><i class="fa fa-check"></i><b>4.2</b> Range in characteristics of ecosites</a></li>
<li class="chapter" data-level="4.3" data-path="ecosites.html"><a href="ecosites.html#mapping-ecological-sites"><i class="fa fa-check"></i><b>4.3</b> Mapping ecological sites</a></li>
<li class="chapter" data-level="4.4" data-path="ecosites.html"><a href="ecosites.html#associated-sites"><i class="fa fa-check"></i><b>4.4</b> Associated sites</a></li>
<li class="chapter" data-level="4.5" data-path="ecosites.html"><a href="ecosites.html#determine-acreage-of-single-ecological-site"><i class="fa fa-check"></i><b>4.5</b> Determine acreage of single ecological site</a></li>
<li class="chapter" data-level="4.6" data-path="ecosites.html"><a href="ecosites.html#determine-acreage-of-multiple-ecological-sites"><i class="fa fa-check"></i><b>4.6</b> Determine acreage of multiple ecological sites</a></li>
<li class="chapter" data-level="4.7" data-path="ecosites.html"><a href="ecosites.html#plotveg"><i class="fa fa-check"></i><b>4.7</b> Accessing plot level vegetation data</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="species.html"><a href="species.html"><i class="fa fa-check"></i><b>5</b> Species</a>
<ul>
<li class="chapter" data-level="5.1" data-path="species.html"><a href="species.html#mapping-the-location-of-species"><i class="fa fa-check"></i><b>5.1</b> Mapping the location of species</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="nasis.html"><a href="nasis.html"><i class="fa fa-check"></i><b>6</b> NASIS</a>
<ul>
<li class="chapter" data-level="6.1" data-path="nasis.html"><a href="nasis.html#creating-a-static-nasis-database"><i class="fa fa-check"></i><b>6.1</b> Creating a Static NASIS database</a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>7</b> Sharing your book</a>
<ul>
<li class="chapter" data-level="7.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>7.1</b> Publishing</a></li>
<li class="chapter" data-level="7.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>7.2</b> 404 pages</a></li>
<li class="chapter" data-level="7.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>7.3</b> Metadata for sharing</a></li>
</ul></li>
<li class="chapter" data-level="" data-path="references.html"><a href="references.html"><i class="fa fa-check"></i>References</a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">NRCS Ecologist FAQs</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="components" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Components<a href="components.html#components" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<p>Components are one of the core concepts in the NRCS ecological workflow. Ecosites are correlated to components.</p>
<p>Often times we will access component level data using a query and then the fetchNASIS function. One of the fetchNASIS arguments is duplicates. This argument helps to deal with the fact that components (coiids) can be associated with multiple legends. In the vast majority of cases, a component being associated with multiple legends is the result of a MLRA mapunit. An MLRA mapunit uses the same data mapunit across survey boundaries. MLRA mapunits are increasingly popular because they allow mapunits to span larger, environmentally contiguous areas, like MLRAs, rather than being restricted to political or administrative boundaries, like counties and soil survey areas. As a result, a component (coiid) can be associate with multiple legends. By default (duplicates = FALSE), fetchNASIS outputs a single instance for each component and does not include legend level information, such as areasymbol, mukey, muacres, etc. To include legend level information, you must duplicate (duplicates = TRUE) the components, or report each component multiple times if it exists in multiple legends. If duplicates = TRUE, components will be listed for every time they are used in a different legend. If a component is used in four legends, it will be listed four times. When components are duplicated, each instance is associated with a particular legend, therefore the specific legend information will be included. The full list of additional variables that will be include is: coiidcmb, muiid, lmapunitiid, mukey, musym, nationalmusym, muname, mukind, mutype, mustatus, muacres, farmlndcl, repdmu, areasymbol, areaname, ssastatus, cordate.</p>
<div id="componentsinMLRA" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Identify components in MLRA?<a href="components.html#componentsinMLRA" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>There are NASIS Queries that allow querying by MLRA. Unfortunately, this is not the best approach. See the section <a href="mapunits.html#mapunitsinMLRA">What mapunits are in an MLRA</a> for an explanation of why. Spatial intersection of MLRA boundaries and mapunits is more reliable.</p>
<ol style="list-style-type: decimal">
<li>Determine the mapunits in the MLRA using the <a href="mapunits.html#mapunitsinMLRA">Mapunits in MLRA tool</a></li>
<li>Take the group of mapunits and enter them into Query &gt; MLRA09_Temple &gt; ARE/LMU/MU/DMU by Lmukey list.</li>
</ol>
<p>Run against National Database:
<img src="_book/componentsinMLRAquery.JPG" alt="Run against National" /></p>
<p>Run against Local:
<img src="_book/componentsinMLRAlocal.JPG" alt="Run against Local" /></p>
<ol start="3" style="list-style-type: decimal">
<li>Acquire the component names and component IDs using R:</li>
</ol>
<p>Load the soilDB package and fetch NASIS data</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="components.html#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb11-2"><a href="components.html#cb11-2" aria-hidden="true" tabindex="-1"></a>my.components.MLRA <span class="ot">&lt;-</span> <span class="fu">fetchNASIS</span>(<span class="at">from =</span> <span class="st">&quot;components&quot;</span>, <span class="at">duplicates =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<p>Look at component names - the <code>head()</code> function shows just the first six records. Remove the <code>head()</code> function to see all the component names</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="components.html#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my.components.MLRA<span class="sc">$</span>compname)</span></code></pre></div>
<pre><code>## [1] &quot;Clay pits&quot; &quot;Quarry&quot;    &quot;Pits&quot;      &quot;Dams&quot;      &quot;Water&quot;     &quot;Dams&quot;</code></pre>
<p>Look at the component IDs</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="components.html#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(<span class="fu">site</span>(my.components.MLRA)<span class="sc">$</span>coiid)</span></code></pre></div>
<pre><code>## [1] 1199623  658862 1201344  650195  650196  650195</code></pre>
</div>
<div id="identify-components-in-soil-survey-area" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> Identify components in Soil Survey Area?<a href="components.html#identify-components-in-soil-survey-area" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Queries by Soil Survey Area are much more reliable than queries by MLRA. As previously mentioned, queries by MLRA are not ideal because the mapunit overlap tables are imperfectly populated. The Soil Survey area corresponds to the legend, and this means that components are reliably associated with Soil Survey Areas. Therefore, beginning with a query is the preferred approach:</p>
<ol style="list-style-type: decimal">
<li><p>Run against National
<img src="_book/componentsinSSA.JPG" alt="Run against National SSA" /></p></li>
<li><p>Run against Local
<img src="_book/componentsinSSAlocal.JPG" alt="Run against Local SSA" /></p></li>
<li><p>Acquire component names and IDs using R.</p></li>
</ol>
<p>Load the soilDB package and fetch NASIS data</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="components.html#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb16-2"><a href="components.html#cb16-2" aria-hidden="true" tabindex="-1"></a>my.components.SSA <span class="ot">&lt;-</span> <span class="fu">fetchNASIS</span>(<span class="at">from =</span> <span class="st">&quot;components&quot;</span>, <span class="at">duplicates =</span> <span class="cn">TRUE</span>)</span></code></pre></div>
<pre><code>## Warning: Horizon top depths contain NA! Check depth logic with
## aqp::checkHzDepthLogic()</code></pre>
<pre><code>## Warning: Horizon bottom depths contain NA! Check depth logic with
## aqp::checkHzDepthLogic()</code></pre>
<pre><code>## Warning in `hzidname&lt;-`(`*tmp*`, value = &quot;chiid&quot;): horizon ID name (chiid) not
## unique. unique ID not changed.</code></pre>
<p>Look at component names - the <code>head()</code> function shows just the first six records. Remove the <code>head()</code> function to see all the component names</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="components.html#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my.components.SSA<span class="sc">$</span>compname)</span></code></pre></div>
<pre><code>## [1] &quot;Water&quot;             &quot;Rock outcrop&quot;      &quot;Typic Cryorthents&quot;
## [4] &quot;Benchlake&quot;         &quot;Rock outcrop&quot;      &quot;McDermand&quot;</code></pre>
<p>Look at the component IDs</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="components.html#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(my.components.SSA<span class="sc">$</span>coiid)</span></code></pre></div>
<pre><code>## [1]  650196 2405837 2405838 2405955 2405841 2776001</code></pre>
</div>
<div id="existing-component-ecosite-correlations" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> Existing component, ecosite correlations<a href="components.html#existing-component-ecosite-correlations" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Perhaps we want to see what ecosite each component is correlated to. For this example, we will work with all the components in MLRA 18 using the <a href="index.html#standard">Standard Dataset and packages</a>.</p>
<p>With the Standard Dataset loaded, let’s look at the correlations between component ID and ecosite ID. This script takes our components in MLRA 18, pulls out the site level data (allows us to ignore pedon data), and then selects only the columns for component ID and ecosite ID (there are lots of other columns you can choose from, tailor to your needs). Finally we look at just the <code>head()</code> of the <code>comp.ecosite.correlations</code>. If you want to see the full dataframe, remove <code>head()</code>.</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="components.html#cb24-1" aria-hidden="true" tabindex="-1"></a>comp.ecosite.correlations <span class="ot">&lt;-</span> my.components.MLRA <span class="sc">%&gt;%</span> aqp<span class="sc">::</span><span class="fu">site</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb24-2"><a href="components.html#cb24-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(coiid, ecosite_id)</span>
<span id="cb24-3"><a href="components.html#cb24-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-4"><a href="components.html#cb24-4" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(comp.ecosite.correlations)</span></code></pre></div>
<pre><code>##     coiid ecosite_id
## 1 1199623       &lt;NA&gt;
## 2  658862       &lt;NA&gt;
## 3 1201344       &lt;NA&gt;
## 4  650195       &lt;NA&gt;
## 5  650196       &lt;NA&gt;
## 6  650195       &lt;NA&gt;</code></pre>
</div>
<div id="components-correlated-to-an-ecosite-of-interest" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Components correlated to an ecosite of interest?<a href="components.html#components-correlated-to-an-ecosite-of-interest" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Perhaps there is a specific ecosite we are interested in and we want to see what components are correlated to that ecosite. Let’s say the ecosite is <code>R018XI202CA</code>. We will start with the <code>comp.ecosite.correlations</code> dataframe that we created in the previous example.</p>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="components.html#cb26-1" aria-hidden="true" tabindex="-1"></a>R018XI202CA <span class="ot">&lt;-</span> comp.ecosite.correlations <span class="sc">%&gt;%</span> <span class="fu">filter</span>(ecosite_id <span class="sc">==</span> <span class="st">&quot;F018XA202CA&quot;</span>)</span>
<span id="cb26-2"><a href="components.html#cb26-2" aria-hidden="true" tabindex="-1"></a><span class="fu">head</span>(R018XI202CA) <span class="co"># Again, remove head() to see the full list. </span></span></code></pre></div>
<pre><code>##     coiid  ecosite_id
## 1 1122909 F018XA202CA
## 2 1153767 F018XA202CA
## 3 1153765 F018XA202CA
## 4 1153766 F018XA202CA
## 5 1153763 F018XA202CA
## 6  627676 F018XA202CA</code></pre>
</div>
<div id="ecological-characteristics-of-components-non-programmatic" class="section level2 hasAnchor" number="3.5">
<h2><span class="header-section-number">3.5</span> Ecological characteristics of components? (non-programmatic)<a href="components.html#ecological-characteristics-of-components-non-programmatic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>One of the best ways to do this is a NASIS report: NASIS &gt; Reports &gt; MLRA02_Davis &gt; EXPORT - Ecological site concept data by MUKEY list v3. This report takes mapunit keys (MUKEY) as input. If you are interested in all the components in an MLRA, refer to <a href="mapunits.html#mapunitsinMLRA">What mapunits are in an MLRA?</a>. If you are interested in a Soil Survey Area ……</p>
<ol style="list-style-type: decimal">
<li>Run against National
<img src="_book/ecositereport18.JPG" alt="Run against National ecosite" /></li>
<li>In the resulting output (html output in your browser), click anywhere, ctrl + a (select all), ctrl + c (copy)</li>
<li>Open Excel, click in top left cell, ctrl + v (paste)</li>
<li>Ctrl + a (select all), Insert &gt; Table</li>
</ol>
<p>Now you have a table with lots of ecological characteristics. You can use the column headers to filter in various ways. If you prefer to work in R, save this file as a .csv and read it into R.</p>
</div>
<div id="ecological-characteristics-of-components-programmatic" class="section level2 hasAnchor" number="3.6">
<h2><span class="header-section-number">3.6</span> Ecological characteristics of components? (programmatic)<a href="components.html#ecological-characteristics-of-components-programmatic" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Load the <a href="index.html#standard">Standard Dataset and packages</a>.</p>
<p>Let’s start off by removing miscellaneous areas and minor components. This is
going to simplify things and remove some of the oddities that may exist in the
data. Ecological sciences do not correlate to misc. areas or minor components,
so it will not be a loss to us.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="components.html#cb28-1" aria-hidden="true" tabindex="-1"></a>nasis_selection <span class="ot">&lt;-</span> <span class="fu">subset</span>(my.components.MLRA, compkind <span class="sc">!=</span> <span class="st">&quot;miscellaneous area&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb28-2"><a href="components.html#cb28-2" aria-hidden="true" tabindex="-1"></a>                            majcompflag <span class="sc">==</span> <span class="st">&quot;1&quot;</span>)</span></code></pre></div>
<p><strong><em>Horizon level data</em></strong></p>
<p>Create data frame from the horizon level data. This script provides
the flexibility to add characteristics of interest. If there are other
horizon level data that you are interested in, you can add it following
the same syntax shown below. To see what horizon level data is available,
type ‘<a href="mailto:nasis_selection@horizons" class="email">nasis_selection@horizons</a>$’ into the console. Horizon level data is
summarized into site level info. If you add other horizon level data, make
sure it is summarized in a conceptually meaningful way.</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="components.html#cb29-1" aria-hidden="true" tabindex="-1"></a>horizon_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">texture =</span> nasis_selection<span class="sc">$</span>texture,</span>
<span id="cb29-2"><a href="components.html#cb29-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">frag_vol =</span> nasis_selection<span class="sc">$</span>fragvoltot_r,</span>
<span id="cb29-3"><a href="components.html#cb29-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sand =</span> nasis_selection<span class="sc">$</span>sandtotal_r,</span>
<span id="cb29-4"><a href="components.html#cb29-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clay =</span> nasis_selection<span class="sc">$</span>claytotal_r,</span>
<span id="cb29-5"><a href="components.html#cb29-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sieve10 =</span> nasis_selection<span class="sc">$</span>sieveno10_r,</span>
<span id="cb29-6"><a href="components.html#cb29-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">thickness =</span> nasis_selection<span class="sc">$</span>hzdepb_r <span class="sc">-</span> nasis_selection<span class="sc">$</span>hzdept_r,</span>
<span id="cb29-7"><a href="components.html#cb29-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">rock_frag =</span> nasis_selection<span class="sc">$</span>total_frags_pct,</span>
<span id="cb29-8"><a href="components.html#cb29-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_l =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_l,</span>
<span id="cb29-9"><a href="components.html#cb29-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_r =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_r,</span>
<span id="cb29-10"><a href="components.html#cb29-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_h =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_h,</span>
<span id="cb29-11"><a href="components.html#cb29-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_l =</span> nasis_selection<span class="sc">$</span>awc_l,</span>
<span id="cb29-12"><a href="components.html#cb29-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_r =</span> nasis_selection<span class="sc">$</span>awc_r,</span>
<span id="cb29-13"><a href="components.html#cb29-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_h =</span> nasis_selection<span class="sc">$</span>awc_h,</span>
<span id="cb29-14"><a href="components.html#cb29-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">coiidcmb =</span> nasis_selection<span class="sc">$</span>coiidcmb) <span class="sc">%&gt;%</span> <span class="fu">left_join</span>(<span class="fu">site</span>(nasis_selection) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">select</span>(coiidcmb, coiid)) <span class="sc">%&gt;%</span> </span>
<span id="cb29-15"><a href="components.html#cb29-15" aria-hidden="true" tabindex="-1"></a>                                                                  <span class="fu">select</span>(<span class="sc">-</span>coiidcmb) <span class="sc">%&gt;%</span> dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">component =</span> coiid)</span></code></pre></div>
<pre><code>## Joining, by = &quot;coiidcmb&quot;</code></pre>
<p>Separate the texture column</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="components.html#cb31-1" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_qualifier <span class="ot">&lt;-</span> horizon_df<span class="sc">$</span>texture <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;.*(?=-)&quot;</span>)</span>
<span id="cb31-2"><a href="components.html#cb31-2" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_only <span class="ot">&lt;-</span> horizon_df<span class="sc">$</span>texture <span class="sc">%&gt;%</span> stringr<span class="sc">::</span><span class="fu">str_extract</span>(<span class="st">&quot;(?&lt;=-).*&quot;</span>)</span>
<span id="cb31-3"><a href="components.html#cb31-3" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_only <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(horizon_df<span class="sc">$</span>texture_only), horizon_df<span class="sc">$</span>texture, </span>
<span id="cb31-4"><a href="components.html#cb31-4" aria-hidden="true" tabindex="-1"></a>                                  horizon_df<span class="sc">$</span>texture_only)</span></code></pre></div>
<p>Working with texture:</p>
<p>We have two goals for texture. One, we want to have a textural modifier where
appropriate (i.e., CB, CBV, GR). Two, we want to have a texture (i.e., L, CL,
SC). Ultimately, we want a single textural modifier and a single texture to
represent the entire soil profile. We are starting off with textural modifiers
and textures for each horizon, though. Therefore, we need to consider how to
aggregate that data.</p>
<p>Textural modifiers -</p>
<p>For textural modifiers, we will choose the textural modifier from the thickest
soil horizon and that textural modifier will be used as a value that represents
the entire profile.</p>
<p>Before doing that, we are going to change the depth of horizons that were
not textured. For those horizons that were not textured, we are going to
change the depth to 0.1 cm. This will prevent textural modifiers from being
defined based on a horizon that was not textured. For example, a BR horizon
is automatically assigned a depth of 25 cm. Depth of BR has limited
ecological significance, and we do not want the texture of the soil profile
to be determined by BR conditions. We are also specifically stating that
texture is not equal to “BR” because several horizons that are BR have
values of 0 for sand and clay when they should be NAs.</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="components.html#cb32-1" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>thickness_modified <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(horizon_df<span class="sc">$</span>clay), <span class="fl">0.1</span>, </span>
<span id="cb32-2"><a href="components.html#cb32-2" aria-hidden="true" tabindex="-1"></a>                                        <span class="fu">ifelse</span>(horizon_df<span class="sc">$</span>texture <span class="sc">==</span> <span class="st">&quot;BR&quot;</span>, </span>
<span id="cb32-3"><a href="components.html#cb32-3" aria-hidden="true" tabindex="-1"></a>                                        <span class="fl">0.1</span>, horizon_df<span class="sc">$</span>thickness))</span></code></pre></div>
<p>Now, we assign the textural modifier from the thickest horizon to the component.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="components.html#cb33-1" aria-hidden="true" tabindex="-1"></a>summarized_texture_qualifier <span class="ot">&lt;-</span> horizon_df <span class="sc">%&gt;%</span> </span>
<span id="cb33-2"><a href="components.html#cb33-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component, texture_qualifier) <span class="sc">%&gt;%</span> </span>
<span id="cb33-3"><a href="components.html#cb33-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">combined_thickness =</span> <span class="fu">sum</span>(thickness_modified)) <span class="sc">%&gt;%</span></span>
<span id="cb33-4"><a href="components.html#cb33-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-5"><a href="components.html#cb33-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component) <span class="sc">%&gt;%</span> </span>
<span id="cb33-6"><a href="components.html#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>, combined_thickness) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb33-7"><a href="components.html#cb33-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>combined_thickness) </span></code></pre></div>
<p>Texture -</p>
<p>Now, we are going to assign a texture to the entire profile. For texture, we
have quantitative data (sand and clay percentages). This allows us to do a
weighted average rather than just choosing the texture from the thickest horizon
like we did for texture modifiers.</p>
<p>First, we will remove horizons that do not have textures. We will also remove
horizons labelled with texture as “BR” because some of those bedrock horizons
have sand and clay percentages entered as zero rather than NA. Then, we group the
horizons by the component id and calculate a weighted mean for clay/sand, pH, and
rock frag using the horizon thickness as the weighting.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="components.html#cb34-1" aria-hidden="true" tabindex="-1"></a>weighted_texture <span class="ot">&lt;-</span> horizon_df <span class="sc">%&gt;%</span></span>
<span id="cb34-2"><a href="components.html#cb34-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clay) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sand) <span class="sc">&amp;</span> texture <span class="sc">!=</span> <span class="st">&quot;BR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb34-3"><a href="components.html#cb34-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component) <span class="sc">%&gt;%</span></span>
<span id="cb34-4"><a href="components.html#cb34-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">clay_mean_texture =</span> <span class="fu">weighted.mean</span>(clay, thickness_modified),</span>
<span id="cb34-5"><a href="components.html#cb34-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sand_mean_texture =</span> <span class="fu">weighted.mean</span>(sand, thickness_modified),</span>
<span id="cb34-6"><a href="components.html#cb34-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_l_mean =</span> <span class="fu">weighted.mean</span>(ph_l, thickness_modified),</span>
<span id="cb34-7"><a href="components.html#cb34-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_r_mean =</span> <span class="fu">weighted.mean</span>(ph_r, thickness_modified),</span>
<span id="cb34-8"><a href="components.html#cb34-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_h_mean =</span> <span class="fu">weighted.mean</span>(ph_h, thickness_modified),</span>
<span id="cb34-9"><a href="components.html#cb34-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_l_sum =</span> <span class="fu">sum</span>(awc_l <span class="sc">*</span> thickness_modified),</span>
<span id="cb34-10"><a href="components.html#cb34-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_r_sum =</span> <span class="fu">sum</span>(awc_r <span class="sc">*</span> thickness_modified),</span>
<span id="cb34-11"><a href="components.html#cb34-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_h_sum =</span> <span class="fu">sum</span>(awc_h <span class="sc">*</span> thickness_modified),</span>
<span id="cb34-12"><a href="components.html#cb34-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rock_frag =</span> <span class="fu">weighted.mean</span>(rock_frag, thickness_modified),</span>
<span id="cb34-13"><a href="components.html#cb34-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">depth_to_restr =</span> <span class="fu">sum</span>(thickness_modified)) <span class="sc">%&gt;%</span></span>
<span id="cb34-14"><a href="components.html#cb34-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">textural_class =</span> aqp<span class="sc">::</span><span class="fu">ssc_to_texcl</span>(<span class="at">clay =</span> clay_mean_texture,</span>
<span id="cb34-15"><a href="components.html#cb34-15" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">sand =</span> sand_mean_texture))</span></code></pre></div>
<p>Combine the texture qualifiers and the textures into a dataframe</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="components.html#cb35-1" aria-hidden="true" tabindex="-1"></a>horizon_to_component_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(summarized_texture_qualifier, weighted_texture)</span></code></pre></div>
<p><strong><em>Component level data</em></strong></p>
<p>Here, we change gears and start assembling component level data.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="components.html#cb36-1" aria-hidden="true" tabindex="-1"></a>component_data <span class="ot">&lt;-</span></span>
<span id="cb36-2"><a href="components.html#cb36-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">site</span>(nasis_selection),</span>
<span id="cb36-3"><a href="components.html#cb36-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">data.frame</span>(</span>
<span id="cb36-4"><a href="components.html#cb36-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">coiid =</span> coiid,</span>
<span id="cb36-5"><a href="components.html#cb36-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">compname =</span> compname,</span>
<span id="cb36-6"><a href="components.html#cb36-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">compkind =</span> compkind,</span>
<span id="cb36-7"><a href="components.html#cb36-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">areasymbol =</span> areasymbol,</span>
<span id="cb36-8"><a href="components.html#cb36-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">areaname =</span> areaname,</span>
<span id="cb36-9"><a href="components.html#cb36-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">comppct_r =</span> comppct_r,</span>
<span id="cb36-10"><a href="components.html#cb36-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_l =</span> slope_l,</span>
<span id="cb36-11"><a href="components.html#cb36-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_r =</span> slope_r,</span>
<span id="cb36-12"><a href="components.html#cb36-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_h =</span> slope_h,</span>
<span id="cb36-13"><a href="components.html#cb36-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">majcompflag =</span> majcompflag,</span>
<span id="cb36-14"><a href="components.html#cb36-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">pmkind =</span> pmkind,</span>
<span id="cb36-15"><a href="components.html#cb36-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">dmuiid =</span> dmuiid,</span>
<span id="cb36-16"><a href="components.html#cb36-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">pmorigin =</span> pmorigin,</span>
<span id="cb36-17"><a href="components.html#cb36-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">surf_frag =</span> surface_total_frags_pct,</span>
<span id="cb36-18"><a href="components.html#cb36-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_l =</span> elev_l,</span>
<span id="cb36-19"><a href="components.html#cb36-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_rv =</span> elev_r,</span>
<span id="cb36-20"><a href="components.html#cb36-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_h =</span> elev_h,</span>
<span id="cb36-21"><a href="components.html#cb36-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_l =</span> map_l,</span>
<span id="cb36-22"><a href="components.html#cb36-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_rv =</span> map_r,</span>
<span id="cb36-23"><a href="components.html#cb36-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_h =</span> map_h,</span>
<span id="cb36-24"><a href="components.html#cb36-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_l =</span> maat_l,</span>
<span id="cb36-25"><a href="components.html#cb36-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_rv =</span> maat_r,</span>
<span id="cb36-26"><a href="components.html#cb36-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_h =</span> maat_h,</span>
<span id="cb36-27"><a href="components.html#cb36-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_l =</span> ffd_l,</span>
<span id="cb36-28"><a href="components.html#cb36-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_rv =</span> ffd_r,</span>
<span id="cb36-29"><a href="components.html#cb36-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_h =</span> ffd_h,</span>
<span id="cb36-30"><a href="components.html#cb36-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectccwise =</span> aspectccwise,</span>
<span id="cb36-31"><a href="components.html#cb36-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectrep =</span> aspectrep,</span>
<span id="cb36-32"><a href="components.html#cb36-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectcwise =</span> aspectcwise,</span>
<span id="cb36-33"><a href="components.html#cb36-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">landform =</span> landform_string,</span>
<span id="cb36-34"><a href="components.html#cb36-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxtemp =</span> taxtempregime,</span>
<span id="cb36-35"><a href="components.html#cb36-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">drainagecl =</span> drainagecl,</span>
<span id="cb36-36"><a href="components.html#cb36-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">ecosite =</span> ecosite_name,</span>
<span id="cb36-37"><a href="components.html#cb36-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">ecosite_id =</span> ecosite_id,</span>
<span id="cb36-38"><a href="components.html#cb36-38" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxorder =</span> taxorder,</span>
<span id="cb36-39"><a href="components.html#cb36-39" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxsuborder =</span> taxsuborder</span>
<span id="cb36-40"><a href="components.html#cb36-40" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb36-41"><a href="components.html#cb36-41" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Collect restriction data</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="components.html#cb37-1" aria-hidden="true" tabindex="-1"></a>restriction_data <span class="ot">&lt;-</span> <span class="fu">restrictions</span>(nasis_selection) <span class="sc">%&gt;%</span></span>
<span id="cb37-2"><a href="components.html#cb37-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(coiid, reskind, resdept_l, resdept_r, resdept_h, reshard) <span class="sc">%&gt;%</span></span>
<span id="cb37-3"><a href="components.html#cb37-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;noncemented&quot;</span>, reshard)) <span class="sc">%&gt;%</span></span>
<span id="cb37-4"><a href="components.html#cb37-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(coiid) <span class="sc">%&gt;%</span></span>
<span id="cb37-5"><a href="components.html#cb37-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(resdept_r) <span class="sc">%&gt;%</span></span>
<span id="cb37-6"><a href="components.html#cb37-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Merge component data and restriction data</p>
<div class="sourceCode" id="cb38"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb38-1"><a href="components.html#cb38-1" aria-hidden="true" tabindex="-1"></a>component_data_combined <span class="ot">&lt;-</span> <span class="fu">left_join</span>(component_data, restriction_data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;coiid&quot;</code></pre>
<p><strong><em>Merge horizon data and component data</em></strong></p>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="components.html#cb40-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> horizon_to_component_data <span class="sc">%&gt;%</span></span>
<span id="cb40-2"><a href="components.html#cb40-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">coiid =</span> component) <span class="sc">%&gt;%</span></span>
<span id="cb40-3"><a href="components.html#cb40-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(component_data_combined) <span class="sc">%&gt;%</span></span>
<span id="cb40-4"><a href="components.html#cb40-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(coiid,  compname, ecosite, ecosite_id, landform, pmkind, </span>
<span id="cb40-5"><a href="components.html#cb40-5" aria-hidden="true" tabindex="-1"></a>                pmorigin, taxtemp, textural_class, texture_qualifier, </span>
<span id="cb40-6"><a href="components.html#cb40-6" aria-hidden="true" tabindex="-1"></a>                rock_frag, surf_frag, depth_to_restr, drainagecl, slope_l, </span>
<span id="cb40-7"><a href="components.html#cb40-7" aria-hidden="true" tabindex="-1"></a>                slope_r, slope_h, ph_l_mean, ph_r_mean, ph_h_mean, elev_l, </span>
<span id="cb40-8"><a href="components.html#cb40-8" aria-hidden="true" tabindex="-1"></a>                elev_rv, elev_h, map_l, map_rv, map_h, maat_l, maat_rv, </span>
<span id="cb40-9"><a href="components.html#cb40-9" aria-hidden="true" tabindex="-1"></a>                maat_h, ffd_l, ffd_rv, ffd_h ,comppct_r, dmuiid, </span>
<span id="cb40-10"><a href="components.html#cb40-10" aria-hidden="true" tabindex="-1"></a>                <span class="fu">everything</span>())</span></code></pre></div>
<p>Save as csv</p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="components.html#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_data, <span class="st">&quot;C:/Users/Nathan.Roe/Downloads/my_ecosite_report.csv&quot;</span>,</span>
<span id="cb41-2"><a href="components.html#cb41-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
</div>
<div id="where-do-components-occur" class="section level2 hasAnchor" number="3.7">
<h2><span class="header-section-number">3.7</span> Where do components occur?<a href="components.html#where-do-components-occur" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="how-to-correlate-components-to-ecosites" class="section level2 hasAnchor" number="3.8">
<h2><span class="header-section-number">3.8</span> How to correlate components to ecosites?<a href="components.html#how-to-correlate-components-to-ecosites" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="how-to-qc-the-correlation-between" class="section level2 hasAnchor" number="3.9">
<h2><span class="header-section-number">3.9</span> How to QC the correlation between<a href="components.html#how-to-qc-the-correlation-between" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="test-section" class="section level2 hasAnchor" number="3.10">
<h2><span class="header-section-number">3.10</span> Test section<a href="components.html#test-section" class="anchor-section" aria-label="Anchor link to header"></a></h2>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="mapunits.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="ecosites.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/02-components.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

</body>

</html>
