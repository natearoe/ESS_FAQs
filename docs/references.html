<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>References | Ecosite_Report</title>
  <meta name="description" content="This is a compilation of FAQs for NRCS Ecologists." />
  <meta name="generator" content="bookdown 0.25 and GitBook 2.6.7" />

  <meta property="og:title" content="References | Ecosite_Report" />
  <meta property="og:type" content="book" />
  
  <meta property="og:description" content="This is a compilation of FAQs for NRCS Ecologists." />
  <meta name="github-repo" content="rstudio/bookdown-demo" />

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="References | Ecosite_Report" />
  
  <meta name="twitter:description" content="This is a compilation of FAQs for NRCS Ecologists." />
  

<meta name="author" content="Nathan Roe" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="sharing-your-book.html"/>

<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
/* Used with Pandoc 2.11+ new --citeproc when CSL is used */
div.csl-bib-body { }
div.csl-entry {
  clear: both;
}
.hanging div.csl-entry {
  margin-left:2em;
  text-indent:-2em;
}
div.csl-left-margin {
  min-width:2em;
  float:left;
}
div.csl-right-inline {
  margin-left:2em;
  padding-left:1em;
}
div.csl-indent {
  margin-left: 2em;
}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">ESS FAQs</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction<span></span></a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#overview"><i class="fa fa-check"></i><b>1.1</b> Overview<span></span></a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#obcd-connection"><i class="fa fa-check"></i><b>1.2</b> OBCD Connection<span></span></a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="mapunits.html"><a href="mapunits.html"><i class="fa fa-check"></i><b>2</b> Mapunits<span></span></a>
<ul>
<li class="chapter" data-level="2.1" data-path="mapunits.html"><a href="mapunits.html#mapunitsinMLRA"><i class="fa fa-check"></i><b>2.1</b> What mapunits are in an MLRA?<span></span></a></li>
<li class="chapter" data-level="2.2" data-path="mapunits.html"><a href="mapunits.html#mapunitsinSSA"><i class="fa fa-check"></i><b>2.2</b> What mapunits are in a Soil Survey Area?<span></span></a></li>
<li class="chapter" data-level="2.3" data-path="mapunits.html"><a href="mapunits.html#mapping-mapunits"><i class="fa fa-check"></i><b>2.3</b> Mapping mapunits<span></span></a></li>
</ul></li>
<li class="chapter" data-level="3" data-path="components.html"><a href="components.html"><i class="fa fa-check"></i><b>3</b> Components<span></span></a>
<ul>
<li class="chapter" data-level="3.1" data-path="components.html"><a href="components.html#componentsinMLRA"><i class="fa fa-check"></i><b>3.1</b> Identify components in MLRA?<span></span></a></li>
<li class="chapter" data-level="3.2" data-path="components.html"><a href="components.html#identify-components-in-soil-survey-area"><i class="fa fa-check"></i><b>3.2</b> Identify components in Soil Survey Area?<span></span></a></li>
<li class="chapter" data-level="3.3" data-path="components.html"><a href="components.html#existing-component-ecosite-correlations"><i class="fa fa-check"></i><b>3.3</b> Existing component, ecosite correlations<span></span></a></li>
<li class="chapter" data-level="3.4" data-path="components.html"><a href="components.html#components-correlated-to-an-ecosite-of-interest"><i class="fa fa-check"></i><b>3.4</b> Components correlated to an ecosite of interest?<span></span></a></li>
<li class="chapter" data-level="3.5" data-path="components.html"><a href="components.html#ecological-characteristics-of-components-non-programmatic"><i class="fa fa-check"></i><b>3.5</b> Ecological characteristics of components? (non-programmatic)<span></span></a></li>
<li class="chapter" data-level="3.6" data-path="components.html"><a href="components.html#ecological-characteristics-of-components-programmatic"><i class="fa fa-check"></i><b>3.6</b> Ecological characteristics of components? (programmatic)<span></span></a></li>
<li class="chapter" data-level="3.7" data-path="components.html"><a href="components.html#where-do-components-occur"><i class="fa fa-check"></i><b>3.7</b> Where do components occur?<span></span></a></li>
<li class="chapter" data-level="3.8" data-path="components.html"><a href="components.html#how-to-correlate-components-to-ecosites"><i class="fa fa-check"></i><b>3.8</b> How to correlate components to ecosites?<span></span></a></li>
<li class="chapter" data-level="3.9" data-path="components.html"><a href="components.html#how-to-qc-the-correlation-between"><i class="fa fa-check"></i><b>3.9</b> How to QC the correlation between<span></span></a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="ecosites.html"><a href="ecosites.html"><i class="fa fa-check"></i><b>4</b> Ecosites<span></span></a>
<ul>
<li class="chapter" data-level="4.1" data-path="ecosites.html"><a href="ecosites.html#what-ecosites-are-active-in-an-mlra"><i class="fa fa-check"></i><b>4.1</b> What ecosites are active in an MLRA?<span></span></a></li>
<li class="chapter" data-level="4.2" data-path="ecosites.html"><a href="ecosites.html#range-in-characteristics-of-ecosites"><i class="fa fa-check"></i><b>4.2</b> Range in characteristics of ecosites<span></span></a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html"><i class="fa fa-check"></i><b>5</b> Footnotes and citations<span></span></a>
<ul>
<li class="chapter" data-level="5.1" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#footnotes"><i class="fa fa-check"></i><b>5.1</b> Footnotes<span></span></a></li>
<li class="chapter" data-level="5.2" data-path="footnotes-and-citations.html"><a href="footnotes-and-citations.html#citations"><i class="fa fa-check"></i><b>5.2</b> Citations<span></span></a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="blocks.html"><a href="blocks.html"><i class="fa fa-check"></i><b>6</b> Blocks<span></span></a>
<ul>
<li class="chapter" data-level="6.1" data-path="blocks.html"><a href="blocks.html#equations"><i class="fa fa-check"></i><b>6.1</b> Equations<span></span></a></li>
<li class="chapter" data-level="6.2" data-path="blocks.html"><a href="blocks.html#theorems-and-proofs"><i class="fa fa-check"></i><b>6.2</b> Theorems and proofs<span></span></a></li>
<li class="chapter" data-level="6.3" data-path="blocks.html"><a href="blocks.html#callout-blocks"><i class="fa fa-check"></i><b>6.3</b> Callout blocks<span></span></a></li>
</ul></li>
<li class="chapter" data-level="7" data-path="sharing-your-book.html"><a href="sharing-your-book.html"><i class="fa fa-check"></i><b>7</b> Sharing your book<span></span></a>
<ul>
<li class="chapter" data-level="7.1" data-path="sharing-your-book.html"><a href="sharing-your-book.html#publishing"><i class="fa fa-check"></i><b>7.1</b> Publishing<span></span></a></li>
<li class="chapter" data-level="7.2" data-path="sharing-your-book.html"><a href="sharing-your-book.html#pages"><i class="fa fa-check"></i><b>7.2</b> 404 pages<span></span></a></li>
<li class="chapter" data-level="7.3" data-path="sharing-your-book.html"><a href="sharing-your-book.html#metadata-for-sharing"><i class="fa fa-check"></i><b>7.3</b> Metadata for sharing<span></span></a></li>
</ul></li>
<li><a href="references.html#references">References<span></span></a></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>

</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Ecosite_Report</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="references" class="section level1 unnumbered hasAnchor">
<h1>References<a href="references.html#references" class="anchor-section" aria-label="Anchor link to header"></a></h1>

<p>This script is used to populate a table of ecological characteristics of map
unit components. This resulting table can be used to correlate ecosites to
mapunit components. A similar product can be produced using the NASIS report,
NASIS &gt; Reports &gt; MLRA02_Davis &gt; EXPORT - Ecological site concept data by
MUKEY list v3. This report produced here is cleaner and easier to work with. In
addition, you will need to produce this report to continue with the methodology
that will be used to assign correlations between mapunit components and ecosites
using randomforest.</p>
<p>Another important attribute of this approach is that is applies much less weight
to the particle size control section. I need to think about this a little bit
more, but in my opinion, this is a soil taxonomy concept. Plants are associating
with soil horizons throughout their rooting depth. For some soil properties, it is probably
the summation of the properties throughout the rooting depth that is most
ecologically relevant. For example, the summation of the available water
capacity throughout the soil profile. That is infact how we calculate AWC in this
approach. Most of the other attribute, such as percent sand and clay are
calculate as weighted averages across the profile using the horizon thickness as
the weighting parameter.</p>
<p>Selected set: Determine an appropriate selected set. I am using the
<a href="https://nroe.shinyapps.io/MapunitsInMLRA/" class="uri">https://nroe.shinyapps.io/MapunitsInMLRA/</a> tool to determine all the mapunits in
my MLRA and then using the NASIS Query, NSSC Pangaea &gt; Area/Legend/Mapunit/DMU
by record ID - LMAPUNITIID.</p>
<p>Packages</p>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="references.html#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(sf)</span></code></pre></div>
<pre><code>## Warning: package &#39;sf&#39; was built under R version 4.1.3</code></pre>
<pre><code>## Linking to GEOS 3.9.1, GDAL 3.2.1, PROJ 7.2.1; sf_use_s2() is TRUE</code></pre>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="references.html#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(aqp)</span>
<span id="cb46-2"><a href="references.html#cb46-2" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(dplyr)</span>
<span id="cb46-3"><a href="references.html#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(soilDB)</span>
<span id="cb46-4"><a href="references.html#cb46-4" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(stringr)</span></code></pre></div>
<p>Pull data from NASIS selected set</p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="references.html#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="co"># nasis_selection &lt;- fetchNASIS(from = &quot;components&quot;, rmHzErrors = FALSE)</span></span>
<span id="cb47-2"><a href="references.html#cb47-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-3"><a href="references.html#cb47-3" aria-hidden="true" tabindex="-1"></a>nasis_selection <span class="ot">&lt;-</span> <span class="fu">fetchNASIS</span>(<span class="at">from =</span> <span class="st">&quot;components&quot;</span>, <span class="at">dsn =</span> <span class="st">&quot;C:/Users/Nathan.Roe/Documents/ESS-FAQ/SQlite_tables/components18pedondata.sqlite&quot;</span>, <span class="at">SS =</span> <span class="cn">FALSE</span>)</span></code></pre></div>
<pre><code>## NOTE: some records are missing surface fragment cover</code></pre>
<pre><code>## NOTE: some records are missing rock fragment volume</code></pre>
<pre><code>## NOTE: all records are missing artifact volume</code></pre>
<pre><code>## -&gt; QC: multiple othervegclasses / component.
##  Use `get(&#39;multiple.otherveg.per.coiid&#39;, envir=soilDB.env)` for component record IDs (coiid)</code></pre>
<pre><code>## -&gt; QC: multiple ecosites / component.
##  Use `get(&#39;multiple.ecosite.per.coiid&#39;, envir=soilDB.env)` for component record IDs (coiid)</code></pre>
<pre><code>## converting profile IDs from integer to character</code></pre>
<pre><code>## -&gt; QC: horizon errors detected:
##  Use `get(&#39;component.hz.problems&#39;, envir=soilDB.env)` for component record IDs (coiid)</code></pre>
<pre><code>## converting horizon IDs in column `chiid` to character</code></pre>
<p>Let’s start off by removing miscellaneous areas and minor components. This is
going to simplify things and remove some of the oddities that may exist in the
data. Ecological sciences do not correlate to misc. areas or minor components,
so it will not be a loss to us.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="references.html#cb56-1" aria-hidden="true" tabindex="-1"></a>nasis_selection <span class="ot">&lt;-</span> <span class="fu">subset</span>(nasis_selection, compkind <span class="sc">!=</span> <span class="st">&quot;miscellaneous area&quot;</span> <span class="sc">&amp;</span></span>
<span id="cb56-2"><a href="references.html#cb56-2" aria-hidden="true" tabindex="-1"></a>                            majcompflag <span class="sc">==</span> <span class="st">&quot;1&quot;</span>)</span></code></pre></div>
<p><strong><em>Horizon level data</em></strong>
Create data frame from the horizon level data. This script provides
the flexibility to add characteristics of interest. If there are other
horizon level data that you are interested in, you can add it following
the same syntax shown below. To see what horizon level data is available,
type ‘<a href="mailto:nasis_selection@horizons" class="email">nasis_selection@horizons</a>$’ into the console. Horizon level data is
summarized into site level info. If you add other horizon level data, make
sure it is summarized in a conceptually meaningful way.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="references.html#cb57-1" aria-hidden="true" tabindex="-1"></a>horizon_df <span class="ot">&lt;-</span> <span class="fu">data.frame</span>(<span class="at">component =</span> nasis_selection<span class="sc">$</span>coiid,</span>
<span id="cb57-2"><a href="references.html#cb57-2" aria-hidden="true" tabindex="-1"></a>                         <span class="at">texture =</span> nasis_selection<span class="sc">$</span>texture,</span>
<span id="cb57-3"><a href="references.html#cb57-3" aria-hidden="true" tabindex="-1"></a>                         <span class="at">frag_vol =</span> nasis_selection<span class="sc">$</span>fragvoltot_r,</span>
<span id="cb57-4"><a href="references.html#cb57-4" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sand =</span> nasis_selection<span class="sc">$</span>sandtotal_r,</span>
<span id="cb57-5"><a href="references.html#cb57-5" aria-hidden="true" tabindex="-1"></a>                         <span class="at">clay =</span> nasis_selection<span class="sc">$</span>claytotal_r,</span>
<span id="cb57-6"><a href="references.html#cb57-6" aria-hidden="true" tabindex="-1"></a>                         <span class="at">sieve10 =</span> nasis_selection<span class="sc">$</span>sieveno10_r,</span>
<span id="cb57-7"><a href="references.html#cb57-7" aria-hidden="true" tabindex="-1"></a>                         <span class="at">thickness =</span> nasis_selection<span class="sc">$</span>hzdepb_r <span class="sc">-</span> nasis_selection<span class="sc">$</span>hzdept_r,</span>
<span id="cb57-8"><a href="references.html#cb57-8" aria-hidden="true" tabindex="-1"></a>                         <span class="at">rock_frag =</span> nasis_selection<span class="sc">$</span>total_frags_pct,</span>
<span id="cb57-9"><a href="references.html#cb57-9" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_l =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_l,</span>
<span id="cb57-10"><a href="references.html#cb57-10" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_r =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_r,</span>
<span id="cb57-11"><a href="references.html#cb57-11" aria-hidden="true" tabindex="-1"></a>                         <span class="at">ph_h =</span> nasis_selection<span class="sc">$</span>ph1to1h2o_h,</span>
<span id="cb57-12"><a href="references.html#cb57-12" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_l =</span> nasis_selection<span class="sc">$</span>awc_l,</span>
<span id="cb57-13"><a href="references.html#cb57-13" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_r =</span> nasis_selection<span class="sc">$</span>awc_r,</span>
<span id="cb57-14"><a href="references.html#cb57-14" aria-hidden="true" tabindex="-1"></a>                         <span class="at">awc_h =</span> nasis_selection<span class="sc">$</span>awc_h)</span></code></pre></div>
<p>Separate the texture column</p>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="references.html#cb58-1" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_qualifier <span class="ot">&lt;-</span> horizon_df<span class="sc">$</span>texture <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="st">&quot;.*(?=-)&quot;</span>)</span>
<span id="cb58-2"><a href="references.html#cb58-2" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_only <span class="ot">&lt;-</span> horizon_df<span class="sc">$</span>texture <span class="sc">%&gt;%</span> <span class="fu">str_extract</span>(<span class="st">&quot;(?&lt;=-).*&quot;</span>)</span>
<span id="cb58-3"><a href="references.html#cb58-3" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>texture_only <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(horizon_df<span class="sc">$</span>texture_only), horizon_df<span class="sc">$</span>texture, horizon_df<span class="sc">$</span>texture_only)</span></code></pre></div>
<p>Working with texture:</p>
<p>We have two goals for texture. One, we want to have a textural modifier where
appropriate (i.e., CB, CBV, GR). Two, we want to have a texture (i.e., L, CL,
SC). Ultimately, we want a single textural modifier and a single texture to
represent the entire soil profile. We are starting off with textural modifiers
and textures for each horizon, though. Therefore, we need to consider how to
aggregate that data.</p>
<p>Textural modifiers -</p>
<p>For textural modifiers, we will choose the textural modifier from the thickest
soil horizon and that textural modifier will be used as a value that represents
the entire profile.</p>
<p>Before doing that, we are going to change the depth of horizons that were
not textured. For those horizons that were not textured, we are going to
change the depth to 0.1 cm. This will prevent textural modifiers from being
defined based on a horizon that was not textured. For example, a BR horizon
is automatically assigned a depth of 25 cm. Depth of BR has limited
ecological significance, and we do not want the texture of the soil profile
to be determined by BR conditions. We are also specifically stating that
texture is not equal to “BR” because several horizons that are BR have
values of 0 for sand and clay when they should be NAs.</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="references.html#cb59-1" aria-hidden="true" tabindex="-1"></a>horizon_df<span class="sc">$</span>thickness_modified <span class="ot">&lt;-</span> <span class="fu">ifelse</span>(<span class="fu">is.na</span>(horizon_df<span class="sc">$</span>clay), <span class="fl">0.1</span>, <span class="fu">ifelse</span>(horizon_df<span class="sc">$</span>texture <span class="sc">==</span> <span class="st">&quot;BR&quot;</span>, <span class="fl">0.1</span>, horizon_df<span class="sc">$</span>thickness))</span></code></pre></div>
<p>Now, we assign the textural modifier from the thickest horizon to the component.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="references.html#cb60-1" aria-hidden="true" tabindex="-1"></a>summarized_texture_qualifier <span class="ot">&lt;-</span> horizon_df <span class="sc">%&gt;%</span> </span>
<span id="cb60-2"><a href="references.html#cb60-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component, texture_qualifier) <span class="sc">%&gt;%</span> </span>
<span id="cb60-3"><a href="references.html#cb60-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarize</span>(<span class="at">combined_thickness =</span> <span class="fu">sum</span>(thickness_modified)) <span class="sc">%&gt;%</span></span>
<span id="cb60-4"><a href="references.html#cb60-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-5"><a href="references.html#cb60-5" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component) <span class="sc">%&gt;%</span> </span>
<span id="cb60-6"><a href="references.html#cb60-6" aria-hidden="true" tabindex="-1"></a>  <span class="fu">top_n</span>(<span class="dv">1</span>, combined_thickness) <span class="sc">%&gt;%</span> <span class="fu">ungroup</span>() <span class="sc">%&gt;%</span> </span>
<span id="cb60-7"><a href="references.html#cb60-7" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(<span class="sc">-</span>combined_thickness) </span></code></pre></div>
<pre><code>## `summarise()` has grouped output by &#39;component&#39;. You can override using the
## `.groups` argument.</code></pre>
<p>Texture -</p>
<p>Now, we are going to assign a texture to the entire profile. For texture, we
have quantitative data (sand and clay percentages). This allows us to do a
weighted average rather than just choosing the texture from the thickest horizon
like we did for texture modifiers.</p>
<p>First, we will remove horizons that do not have textures. We will also remove
horizons labelled with texture as “BR” because some of those bedrock horizons
have sand and clay percentages entered as zero rather than NA. Then, we group the
horizons by the component id and calculate a weighted mean for clay/sand, pH, and
rock frag using the horizon thickness as the weighting.</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="references.html#cb62-1" aria-hidden="true" tabindex="-1"></a>weighted_texture <span class="ot">&lt;-</span> horizon_df <span class="sc">%&gt;%</span></span>
<span id="cb62-2"><a href="references.html#cb62-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">filter</span>(<span class="sc">!</span><span class="fu">is.na</span>(clay) <span class="sc">&amp;</span> <span class="sc">!</span><span class="fu">is.na</span>(sand) <span class="sc">&amp;</span> texture <span class="sc">!=</span> <span class="st">&quot;BR&quot;</span>) <span class="sc">%&gt;%</span></span>
<span id="cb62-3"><a href="references.html#cb62-3" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(component) <span class="sc">%&gt;%</span></span>
<span id="cb62-4"><a href="references.html#cb62-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">summarise</span>(<span class="at">clay_mean_texture =</span> <span class="fu">weighted.mean</span>(clay, thickness_modified),</span>
<span id="cb62-5"><a href="references.html#cb62-5" aria-hidden="true" tabindex="-1"></a>                   <span class="at">sand_mean_texture =</span> <span class="fu">weighted.mean</span>(sand, thickness_modified),</span>
<span id="cb62-6"><a href="references.html#cb62-6" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_l_mean =</span> <span class="fu">weighted.mean</span>(ph_l, thickness_modified),</span>
<span id="cb62-7"><a href="references.html#cb62-7" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_r_mean =</span> <span class="fu">weighted.mean</span>(ph_r, thickness_modified),</span>
<span id="cb62-8"><a href="references.html#cb62-8" aria-hidden="true" tabindex="-1"></a>                   <span class="at">ph_h_mean =</span> <span class="fu">weighted.mean</span>(ph_h, thickness_modified),</span>
<span id="cb62-9"><a href="references.html#cb62-9" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_l_sum =</span> <span class="fu">sum</span>(awc_l <span class="sc">*</span> thickness_modified),</span>
<span id="cb62-10"><a href="references.html#cb62-10" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_r_sum =</span> <span class="fu">sum</span>(awc_r <span class="sc">*</span> thickness_modified),</span>
<span id="cb62-11"><a href="references.html#cb62-11" aria-hidden="true" tabindex="-1"></a>                   <span class="at">awc_h_sum =</span> <span class="fu">sum</span>(awc_h <span class="sc">*</span> thickness_modified),</span>
<span id="cb62-12"><a href="references.html#cb62-12" aria-hidden="true" tabindex="-1"></a>                   <span class="at">rock_frag =</span> <span class="fu">weighted.mean</span>(rock_frag, thickness_modified),</span>
<span id="cb62-13"><a href="references.html#cb62-13" aria-hidden="true" tabindex="-1"></a>                   <span class="at">depth_to_restr =</span> <span class="fu">sum</span>(thickness_modified)) <span class="sc">%&gt;%</span></span>
<span id="cb62-14"><a href="references.html#cb62-14" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">mutate</span>(<span class="at">textural_class =</span> aqp<span class="sc">::</span><span class="fu">ssc_to_texcl</span>(<span class="at">clay =</span> clay_mean_texture,</span>
<span id="cb62-15"><a href="references.html#cb62-15" aria-hidden="true" tabindex="-1"></a>                                                   <span class="at">sand =</span> sand_mean_texture))</span></code></pre></div>
<p>Combine the texture qualifiers and the textures into a dataframe</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="references.html#cb63-1" aria-hidden="true" tabindex="-1"></a>horizon_to_component_data <span class="ot">&lt;-</span> dplyr<span class="sc">::</span><span class="fu">left_join</span>(summarized_texture_qualifier, weighted_texture)</span></code></pre></div>
<pre><code>## Joining, by = &quot;component&quot;</code></pre>
<p><strong><em>Component level data</em></strong></p>
<p>Here, we change gears and start assembling component level data.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="references.html#cb65-1" aria-hidden="true" tabindex="-1"></a>component_data <span class="ot">&lt;-</span></span>
<span id="cb65-2"><a href="references.html#cb65-2" aria-hidden="true" tabindex="-1"></a>  <span class="fu">with</span>(<span class="fu">site</span>(nasis_selection),</span>
<span id="cb65-3"><a href="references.html#cb65-3" aria-hidden="true" tabindex="-1"></a>       <span class="fu">data.frame</span>(</span>
<span id="cb65-4"><a href="references.html#cb65-4" aria-hidden="true" tabindex="-1"></a>         <span class="at">coiid =</span> coiid,</span>
<span id="cb65-5"><a href="references.html#cb65-5" aria-hidden="true" tabindex="-1"></a>         <span class="at">compname =</span> compname,</span>
<span id="cb65-6"><a href="references.html#cb65-6" aria-hidden="true" tabindex="-1"></a>         <span class="at">compkind =</span> compkind,</span>
<span id="cb65-7"><a href="references.html#cb65-7" aria-hidden="true" tabindex="-1"></a>         <span class="at">comppct_r =</span> comppct_r,</span>
<span id="cb65-8"><a href="references.html#cb65-8" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_l =</span> slope_l,</span>
<span id="cb65-9"><a href="references.html#cb65-9" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_r =</span> slope_r,</span>
<span id="cb65-10"><a href="references.html#cb65-10" aria-hidden="true" tabindex="-1"></a>         <span class="at">slope_h =</span> slope_h,</span>
<span id="cb65-11"><a href="references.html#cb65-11" aria-hidden="true" tabindex="-1"></a>         <span class="at">majcompflag =</span> majcompflag,</span>
<span id="cb65-12"><a href="references.html#cb65-12" aria-hidden="true" tabindex="-1"></a>         <span class="at">pmkind =</span> pmkind,</span>
<span id="cb65-13"><a href="references.html#cb65-13" aria-hidden="true" tabindex="-1"></a>         <span class="at">dmuiid =</span> dmuiid,</span>
<span id="cb65-14"><a href="references.html#cb65-14" aria-hidden="true" tabindex="-1"></a>         <span class="at">pmorigin =</span> pmorigin,</span>
<span id="cb65-15"><a href="references.html#cb65-15" aria-hidden="true" tabindex="-1"></a>         <span class="at">surf_frag =</span> surface_total_frags_pct,</span>
<span id="cb65-16"><a href="references.html#cb65-16" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_l =</span> elev_l,</span>
<span id="cb65-17"><a href="references.html#cb65-17" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_rv =</span> elev_r,</span>
<span id="cb65-18"><a href="references.html#cb65-18" aria-hidden="true" tabindex="-1"></a>         <span class="at">elev_h =</span> elev_h,</span>
<span id="cb65-19"><a href="references.html#cb65-19" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_l =</span> map_l,</span>
<span id="cb65-20"><a href="references.html#cb65-20" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_rv =</span> map_r,</span>
<span id="cb65-21"><a href="references.html#cb65-21" aria-hidden="true" tabindex="-1"></a>         <span class="at">map_h =</span> map_h,</span>
<span id="cb65-22"><a href="references.html#cb65-22" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_l =</span> maat_l,</span>
<span id="cb65-23"><a href="references.html#cb65-23" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_rv =</span> maat_r,</span>
<span id="cb65-24"><a href="references.html#cb65-24" aria-hidden="true" tabindex="-1"></a>         <span class="at">maat_h =</span> maat_h,</span>
<span id="cb65-25"><a href="references.html#cb65-25" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_l =</span> ffd_l,</span>
<span id="cb65-26"><a href="references.html#cb65-26" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_rv =</span> ffd_r,</span>
<span id="cb65-27"><a href="references.html#cb65-27" aria-hidden="true" tabindex="-1"></a>         <span class="at">ffd_h =</span> ffd_h,</span>
<span id="cb65-28"><a href="references.html#cb65-28" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectccwise =</span> aspectccwise,</span>
<span id="cb65-29"><a href="references.html#cb65-29" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectrep =</span> aspectrep,</span>
<span id="cb65-30"><a href="references.html#cb65-30" aria-hidden="true" tabindex="-1"></a>         <span class="at">aspectcwise =</span> aspectcwise,</span>
<span id="cb65-31"><a href="references.html#cb65-31" aria-hidden="true" tabindex="-1"></a>         <span class="at">landform =</span> landform_string,</span>
<span id="cb65-32"><a href="references.html#cb65-32" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxtemp =</span> taxtempregime,</span>
<span id="cb65-33"><a href="references.html#cb65-33" aria-hidden="true" tabindex="-1"></a>         <span class="at">drainagecl =</span> drainagecl,</span>
<span id="cb65-34"><a href="references.html#cb65-34" aria-hidden="true" tabindex="-1"></a>         <span class="at">ecosite =</span> ecosite_name,</span>
<span id="cb65-35"><a href="references.html#cb65-35" aria-hidden="true" tabindex="-1"></a>         <span class="at">ecosite_id =</span> ecosite_id,</span>
<span id="cb65-36"><a href="references.html#cb65-36" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxorder =</span> taxorder,</span>
<span id="cb65-37"><a href="references.html#cb65-37" aria-hidden="true" tabindex="-1"></a>         <span class="at">taxsuborder =</span> taxsuborder</span>
<span id="cb65-38"><a href="references.html#cb65-38" aria-hidden="true" tabindex="-1"></a>       )</span>
<span id="cb65-39"><a href="references.html#cb65-39" aria-hidden="true" tabindex="-1"></a>  )</span></code></pre></div>
<p>Collect restriction data</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="references.html#cb66-1" aria-hidden="true" tabindex="-1"></a>restriction_data <span class="ot">&lt;-</span> <span class="fu">restrictions</span>(nasis_selection) <span class="sc">%&gt;%</span></span>
<span id="cb66-2"><a href="references.html#cb66-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(coiid, reskind, resdept_l, resdept_r, resdept_h, reshard) <span class="sc">%&gt;%</span></span>
<span id="cb66-3"><a href="references.html#cb66-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">subset</span>(<span class="sc">!</span><span class="fu">grepl</span>(<span class="st">&quot;noncemented&quot;</span>, reshard)) <span class="sc">%&gt;%</span></span>
<span id="cb66-4"><a href="references.html#cb66-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">group_by</span>(coiid) <span class="sc">%&gt;%</span></span>
<span id="cb66-5"><a href="references.html#cb66-5" aria-hidden="true" tabindex="-1"></a>  <span class="fu">arrange</span>(resdept_r) <span class="sc">%&gt;%</span></span>
<span id="cb66-6"><a href="references.html#cb66-6" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">slice</span>(<span class="dv">1</span>)</span></code></pre></div>
<p>Merge component data and restriction data</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="references.html#cb67-1" aria-hidden="true" tabindex="-1"></a>restriction_data<span class="sc">$</span>coiid <span class="ot">&lt;-</span> <span class="fu">as.character</span>(restriction_data<span class="sc">$</span>coiid)</span>
<span id="cb67-2"><a href="references.html#cb67-2" aria-hidden="true" tabindex="-1"></a>component_data <span class="ot">&lt;-</span> <span class="fu">left_join</span>(component_data, restriction_data)</span></code></pre></div>
<pre><code>## Joining, by = &quot;coiid&quot;</code></pre>
<p><strong><em>Merge horizon data and component data</em></strong></p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="references.html#cb69-1" aria-hidden="true" tabindex="-1"></a>all_data <span class="ot">&lt;-</span> horizon_to_component_data <span class="sc">%&gt;%</span></span>
<span id="cb69-2"><a href="references.html#cb69-2" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">rename</span>(<span class="at">coiid =</span> component) <span class="sc">%&gt;%</span></span>
<span id="cb69-3"><a href="references.html#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="fu">left_join</span>(component_data) <span class="sc">%&gt;%</span></span>
<span id="cb69-4"><a href="references.html#cb69-4" aria-hidden="true" tabindex="-1"></a>  dplyr<span class="sc">::</span><span class="fu">select</span>(coiid,  compname, ecosite, ecosite_id, landform, pmkind, pmorigin, taxtemp, textural_class,</span>
<span id="cb69-5"><a href="references.html#cb69-5" aria-hidden="true" tabindex="-1"></a>         texture_qualifier, rock_frag, surf_frag, depth_to_restr, drainagecl, slope_l, slope_r,</span>
<span id="cb69-6"><a href="references.html#cb69-6" aria-hidden="true" tabindex="-1"></a>         slope_h, ph_l_mean, ph_r_mean, ph_h_mean, elev_l, elev_rv, elev_h,</span>
<span id="cb69-7"><a href="references.html#cb69-7" aria-hidden="true" tabindex="-1"></a>         map_l, map_rv, map_h, maat_l, maat_rv, maat_h, ffd_l, ffd_rv, ffd_h ,comppct_r, dmuiid, <span class="fu">everything</span>())</span></code></pre></div>
<pre><code>## Joining, by = &quot;coiid&quot;</code></pre>
<p>Save as csv</p>
<div class="sourceCode" id="cb71"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb71-1"><a href="references.html#cb71-1" aria-hidden="true" tabindex="-1"></a><span class="fu">write.csv</span>(all_data, <span class="st">&quot;C:/Users/Nathan.Roe/Downloads/my_ecosite_report.csv&quot;</span>,</span>
<span id="cb71-2"><a href="references.html#cb71-2" aria-hidden="true" tabindex="-1"></a>          <span class="at">row.names =</span> <span class="cn">FALSE</span>)</span></code></pre></div>

<div id="refs" class="references csl-bib-body hanging-indent">
<div class="csl-entry">
Xie, Yihui. 2015. <em>Dynamic Documents with <span>R</span> and Knitr</em>. 2nd ed. Boca Raton, Florida: Chapman; Hall/CRC. <a href="http://yihui.org/knitr/">http://yihui.org/knitr/</a>.
</div>
<div class="csl-entry">
———. 2022. <em>Bookdown: Authoring Books and Technical Documents with r Markdown</em>. <a href="https://CRAN.R-project.org/package=bookdown">https://CRAN.R-project.org/package=bookdown</a>.
</div>
</div>
</div>






            </section>

          </div>
        </div>
      </div>
<a href="sharing-your-book.html" class="navigation navigation-prev navigation-unique" aria-label="Previous page"><i class="fa fa-angle-left"></i></a>

    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/USERNAME/REPO/edit/BRANCH/07-references.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": null,
"text": null
},
"download": ["_main.pdf", "_main.epub"],
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
