for(i in MLRA18_ecosites){
mus_with_ecosite_list[[i]] <- my.components.MLRA.reduced %>%
dplyr::filter(mukey %in% ecosite_mukeys_list[[i]])
}
associated_sites <-  lapply(mus_with_ecosite_list, FUN = function(x){
table(x$ecosite_id) %>% as.data.frame() %>% arrange(desc(Freq)) %>%
dplyr::rename(Ecosite = Var1)
})
associated_sites$F018XA202CA
my_ecosite <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == "R018XI105CA")
my_ecosite_compacres <- my_ecosite %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
head(my_ecosite_compacres)
sum(my_ecosite_compacres$comp_acreage)
MLRA18_ecosites <- my.components.MLRA$ecosite_id %>% str_subset(pattern = "18X") %>% unique()
MLRA18_ecosites
names(MLRA18_ecosites) <- MLRA18_ecosites
MLRA18_ecosite_acreage <- data.frame()
?data.frame
colnames(MLRA18_ecosite_acreage) <- c("Ecosite", "Acreage")
MLRA18_ecosite_acreage <- data.frame(matrix(ncol = 2, nrow = 0))
colnames(MLRA18_ecosite_acreage) <- c("Ecosite", "Acreage")
MLRA18_ecosite_acreage
names(MLRA18_ecosites) <- MLRA18_ecosites
MLRA18_ecosite_acreage <- data.frame(matrix(ncol = 2, nrow = 0))
colnames(MLRA18_ecosite_acreage) <- c("Ecosite", "Acreage")
for(i in names(MLRA18_ecosites)){
my_ecosite_loop <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i)
my_ecosite_compacres_loop <- my_ecosite_loop %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
MLRA18_ecosite_acreage <- rbind(MLRA18_ecosite_acreage, as.data.frame(Ecosite = i, Acreage = sum(my_ecosite_compacres_loop$comp_acreage)))
}
for(i in names(MLRA18_ecosites)){
my_ecosite_loop <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i)
my_ecosite_compacres_loop <- my_ecosite_loop %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
}
my_ecosite_compacres_loop
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
my_ecosite <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i)
ecosite_list[[i]] <- my_ecosite_loop %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
}
ecosite_list$F018XI200CA
str(ecosite_list)
my_ecosite <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == "R018XI105CA")
my_ecosite
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
my_ecosite <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i)
ecosite_list[[i]] <- my_ecosite_loop %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
}
str(ecosite_list)
aqp::site(my.components.MLRA)
View(aqp::site(my.components.MLRA))
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
my_ecosite <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i)
ecosite_list[[i]] <- my_ecosite %>% select(ecosite_id, coiid, comppct_r, muacres) %>% mutate(comp_acreage = (comppct_r/100)*muacres)
}
str(ecosite_list)
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = ecosite_id, Acreage = sum(muacres))
}
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = ecosite_id, Acreage = sum(muacres))
}
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = which.max(ecosite_id), Acreage =
sum(muacres))
}
ecosite_list$R018XI163CA
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(muacres))
}
ecosite_list$R018XI163CA
ecosite_list$R018XI105CA
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(comp_acreage))
}
ecosite_list$R018XI105CA
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list)
head(MLRA18_ecosite_acreage)
library(tibble)
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list) %>% remove_rownames()
head(MLRA18_ecosite_acreage)
soilDB::createStaticNASIS(SS = TRUE, tables =
soilDB::get_NASIS_table_name_by_purpose(c("area", "legend", "mapunit", "datamapunit", "component", "metadata", "lookup", "nasis")),
output_path = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite")
veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
veg_data <- fetchVegdata(SS = TRUE)
veg_data$vegplot$siteiid
head(veg_data$vegplot$siteiid)
head(veg_data$vegplot$site_id)
test <- data.frame(UserSiteID = veg_data$vegplot$site_id, DataOrigin = veg_data$vegplot$vegdataorigin)
View(test)
table(test$DataOrigin)
# Now load that vegdata that you saved
veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
library(soilDB)
library(dplyr)
library(plyr)
library(tidyr)
# Now load that vegdata that you saved
veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
table(veg_data$vegplot$vegdataorigin)
View(veg_data$vegplot)
View(veg_data$vegplotspecies)
veg_data$vegtransect
veg_data$vegtransplantsum
View(veg_data$vegtransplantsum)
infile <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined.pdf"
num <- pdf_length(infile)
CA792 <- fetchNASIS(from = "pedons", fill = TRUE)
library(pdftools)
library(dplyr)
library(stringr)
library(soilDB)
library(staplr)
infile <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined.pdf"
num <- pdf_length(infile)
CA792 <- fetchNASIS(from = "pedons", fill = TRUE)
pedon_ids_2012 <- CA792$site_id %>% stringr::str_subset(pattern = "(?<![:digit:])2012") %>% sort()
length(pedon_ids_2012)
length(CA792$site_id)
num/2
pedon_ids_2012
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/scanned_sheets")
names(my_files) <- my_files
for(i in names(my_files)){
in_file <- paste0("C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/scanned_sheets/", i)
staplr::rotate_pages(rotatepages = seq(2, pdf_length(in_file), 2),
page_rotation = 0,
input_filepath = in_file,
output_filepath = paste0("C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/scanned_sheets_final/",
i),
overwrite = TRUE)
}
my_pdfs <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/scanned_sheets_final",
full.names = TRUE) %>% rev()
pdf_combine(input = rev(my_pdfs),
output = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined.pdf")
seq(1001, 1020, 1)
seq(1001, 1020, 1) %>% paste0(, "N")
seq(1001, 1020, 1) %>% paste0("N")
my_site_id <- seq(1001, 1020, 1) %>% paste0("N")
my_site_id_full <- paste0("2012CA792", my_site_id)
# remove from pdfs: 5051 (185:186)
# remove from NASIS:
remove_from <- seq(1001, 1020, 1) %>% paste0("N")
remove_from_nasis <- paste0("2012CA792", remove_from)
pedon_ids_2012
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis]
length(pedon_ids_2012_reduced)
num/2
pedon_ids_2012_reduced
remove_from_more <- c(remove_from, "1037", "1038N", "1073", "1062", "1063", "2007")
remove_from_nasis <- paste0("2012CA792", remove_from_more)
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis]
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis] %>% unique()
# remove from pdfs: 1062 (45:46), 1063 (47:48), 2007 (81:82), 8007 (173:174), 8007 (177:178)
# remove from NASIS: 1001N - 1020N, 1037, 1038N, 1073, the first 9001 - 9004, 1062, 1063, 2007
remove_from <- seq(1001, 1020, 1) %>% paste0("N")
library(pdftools)
library(dplyr)
library(stringr)
library(soilDB)
library(staplr)
infile <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined.pdf"
num <- pdf_length(infile)
CA792 <- fetchNASIS(from = "pedons", fill = TRUE)
pedon_ids_2012 <- CA792$site_id %>% stringr::str_subset(pattern = "(?<![:digit:])2012") %>% sort()
# remove from pdfs: 1062 (45:46), 1063 (47:48), 2007 (81:82), 8007 (173:174), 8007 (177:178)
# remove from NASIS: 1001N - 1020N, 1037, 1038N, 1073, the first 9001 - 9004, 1062, 1063, 2007
remove_from <- seq(1001, 1020, 1) %>% paste0("N")
remove_from_more <- c(remove_from, "1037", "1038N", "1073", "1062", "1063", "2007")
remove_from_nasis <- paste0("2012CA792", remove_from_more)
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis] %>% unique()
staplr::remove_pages(rmpages = c(45:46, 47:48, 81:82, 173:174, 177:178),
input_filepath = infile,
output_filepath = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf")
infile_new <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf"
num <- pdf_length(infile_new)
num/2
length(pedon_ids_2012_reduced)
pedon_ids_2012_reduced
length(pedon_ids_2012_reduced)
num/2
s_plots <- c("1062", "1063", "2007")
paste_s_plots <- paste0("CA792", s_plots)
paste_s_plots
s_plots <- c("1062", "1063", "2007")
paste_s_plots <- paste0("S2012CA792", s_plots)
remove_from_nasis_full <- c(remove_from_nasis, paste_s_plots)
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis] %>% unique()
staplr::remove_pages(rmpages = c(45:46, 47:48, 81:82, 173:174, 177:178),
input_filepath = infile,
output_filepath = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf")
length(pedon_ids_2012_reduced)
num/2
pedon_ids_2012_reduced <- pedon_ids_2012[!pedon_ids_2012 %in% remove_from_nasis_full] %>% unique()
length(pedon_ids_2012_reduced)
pedon_ids_2012_reduced
infile <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined.pdf"
staplr::remove_pages(rmpages = c(45:46, 47:48, 81:82, 173:174, 177:178),
input_filepath = infile,
output_filepath = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf")
infile_new <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf"
num <- pdf_length(infile_new)
num/2
length(pedon_ids_2012_reduced)
staplr::remove_pages(rmpages = c(45:46, 47:48, 63:64, 81:82, 173:174, 177:178),
input_filepath = infile,
output_filepath = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf")
staplr::remove_pages(rmpages = c(45:46, 47:48, 63:64, 81:82, 173:174, 177:178),
input_filepath = infile,
output_filepath = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf")
infile_new <- "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/2012_combined_reduced.pdf"
num <- pdf_length(infile_new)
num/2
length(pedon_ids_2012_reduced)
num <- pdf_length(infile_new)
st <- seq(1, num, 2)
en <- pmin(st + 1, num)
for(i in seq_along(st)){
pdf_subset(infile_new, pages = st[i]:en[i], output = paste0("C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/final/",
pedon_ids_2012[i], ".pdf"))
}
for(i in seq_along(st)){
pdf_subset(infile_new, pages = st[i]:en[i], output = paste0("C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/final/",
pedon_ids_2012_reduced[i], ".pdf"))
}
for(i in seq_along(st)){
pdf_subset(infile_new, pages = st[i]:en[i], output = paste0("C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/2012/final/",
pedon_ids_2012_reduced[i], ".pdf"))
}
julie_additional <- my_files %>% stringr::str_subset(pattern = "(?<=2012CA)7927")
julie_additional <- my_files %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
library(dplyr)
library(stringr)
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs", full.names = TRUE,
recursive = TRUE)
cathy <- my_files %>% stringr::str_subset(pattern = "7925")
julie <- my_files %>% stringr::str_subset(pattern = "(?<!2012CA|2013CA)7921")
nate <- my_files[!my_files %in% c(cathy, julie)] %>% stringr::str_subset(pattern = "CA792")
julie_additional <- my_files %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
julie_additional
file.copy(from = cathy, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/cathy")
file.copy(from = julie, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/julie")
file.copy(from = nate, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/nate")
library(dplyr)
library(stringr)
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs", full.names = TRUE,
recursive = TRUE)
cathy <- my_files %>% stringr::str_subset(pattern = "7925")
julie <- my_files %>% stringr::str_subset(pattern = "(?<!2012CA|2013CA)7921")
nate <- my_files[!my_files %in% c(cathy, julie)] %>% stringr::str_subset(pattern = "CA792")
julie_additional <- my_files %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
file.copy(from = cathy, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/cathy")
file.copy(from = julie, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/julie")
file.copy(from = nate, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/nate")
cathy_site_names <- cathy %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
julie_site_names <- julie %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
nate_site_names <- nate %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
cathy_site_names <- cathy %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
cathy_site_names
julie_site_names
nate_site_names
nate <- my_files[!my_files %in% c(cathy, julie_additional)] %>% stringr::str_subset(pattern = "CA792")
file.copy(from = nate, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/nate")
my_veg_data <- fetchVegdata(SS = TRUE)
head(my_veg_data$vegplot)
my_veg_data %>% dplyr::filter(vegdataorigin == "speadsheet form")
my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "speadsheet form")
head(my_veg_data$vegplot)
my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form")
my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(site_id)
ecology_sites <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(site_id)
my_files[!my_files %in% grep(x = my_files, pattern = ecology_sites)]
ecology_sites
search_terms <- paste0(my_files, collapse = "|")
search_terms
search_terms <- paste0(ecology_sites, collapse = "|")
search_terms
my_files[!my_files %in% str_subset(my_files, pattern = search_terms)]
my_files_reduced <- my_files[!my_files %in% str_subset(my_files, pattern = search_terms)]
my_files_with_ecology <- my_files_reduced <- my_files[my_files %in% str_subset(my_files, pattern = search_terms)]
my_files_with_ecology
site_with_ecology <- my_files_with_ecology %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
site_
site_with_ecology
library(dplyr)
library(stringr)
my_veg_data <- fetchVegdata(SS = TRUE)
ecology_sites <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(site_id)
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs", full.names = TRUE,
recursive = TRUE)
search_terms <- paste0(ecology_sites, collapse = "|")
my_files_reduced <- my_files[!my_files %in% str_subset(my_files, pattern = search_terms)]
my_files_with_ecology <- my_files_reduced <- my_files[my_files %in% str_subset(my_files, pattern = search_terms)]
cathy <- my_files_reduced %>% stringr::str_subset(pattern = "7925")
julie <- my_files_reduced %>% stringr::str_subset(pattern = "(?<!2012CA|2013CA)7921")
julie_additional <- my_files_reduced %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
nate <- my_files_reduced[!my_files_reduced %in% c(cathy, julie_additional)] %>% stringr::str_subset(pattern = "CA792")
file.copy(from = cathy, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/cathy")
file.copy(from = julie, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/julie")
file.copy(from = nate, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/nate")
cathy_site_names <- cathy %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
julie_site_names <- julie %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
nate_site_names <- nate %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
site_with_ecology <- my_files_with_ecology %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
length(site_with_ecology)
site_with_ecology <- my_files_with_ecology %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)")
length(site_with_ecology)
site_with_ecology
site_with_ecology <- my_files_with_ecology %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
site_with_ecology
non_child <- read.csv("C:/Users/Nathan.Roe/Documents/SEKI/AKSite_to_NASIS/non_child_tables/non_child_tables_for_AKSITE_to_NASIS_import.csv")
non_child <- read.csv("C:/Users/Nathan.Roe/Documents/SEKI/AKSite_to_NASIS/non_child_tables/non_child_tables_for_AKSITE_to_NASIS_import.csv")
veg_plot <- read.csv("C:/Users/Nathan.Roe/Documents/SEKI/AKSite_to_NASIS/vegetation/vegetation_for_import.csv")
setdiff(non_child$User.Site.ID, veg_plot$usiteid)
ecology_sites
ecology_sites  %>% paste(collapse = ", ")
setdiff(non_child$User.Site.ID, veg_plot$usiteid)
test <- setdiff(non_child$User.Site.ID, veg_plot$usiteid)
test[4:length(test)]
test[4:length(test)] %>% paste0(collapse = ", ")
test[4:length(test)]
test[4:length(test)-24] %>% paste0(collapse = ", ")
test[4:length(test)-2] %>% paste0(collapse = ", ")
length(test)
length(test[4:length(test)-2])
test[4:(length(test)-2)] %>% paste0(collapse = ", ")
length(test[4:(length(test)-2)])
test[4:(length(test)-2)] %>% paste0(collapse = ", ")
View(my_veg_data$vegplotspecies)
remotes::install_github("ncss-tech/soilDB", dependencies = FALSE)
detach("package:soilDB", unload = TRUE)
remotes::install_github("ncss-tech/soilDB", dependencies = FALSE)
library(dplyr)
library(stringr)
library(soilDB)
my_veg_data <- fetchVegdata(SS = TRUE)
ecology_sites <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(site_id)
View(my_veg_data$vegplotspecies)
View(my_veg_data$vegplot)
my_veg_data <- fetchVegdata(SS = TRUE)
my_veg_data$vegplotspecies
View(my_veg_data$vegplot)
my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form")
my_veg_data_spreadsheet <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form")
my_veg_data_spreadsheet <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(vegplotiid)
head(my_veg_data$vegplotspecies)
my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet)
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet)
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>% dplyr::pull(vegplotid)
spreadsheet_with_plot_inv
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>%
dplyr::pull(vegplotid) %>% unique()
spreadsheet_with_plot_inv
length(spreadsheet_with_plot_inv)
length(ecology_sites)
ecology_sites <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(site_id)
length(ecology_sites)
search_terms <- paste0(spreadsheet_with_plot_inv, collapse = "|")
my_files_reduced <- my_files[!my_files %in% str_subset(my_files, pattern = search_terms)]
my_files_with_ecology <- my_files_reduced <- my_files[my_files %in% str_subset(my_files, pattern = search_terms)]
cathy <- my_files_reduced %>% stringr::str_subset(pattern = "7925")
julie <- my_files_reduced %>% stringr::str_subset(pattern = "(?<!2012CA|2013CA)7921")
julie_additional <- my_files_reduced %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
nate <- my_files_reduced[!my_files_reduced %in% c(cathy, julie_additional)] %>% stringr::str_subset(pattern = "CA792")
file.copy(from = cathy, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/cathy")
file.copy(from = julie, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/julie")
file.copy(from = nate, to = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs/nate")
cathy_site_names <- cathy %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
julie_site_names <- julie %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
nate_site_names <- nate %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
site_with_ecology <- my_files_with_ecology %>% stringr::str_extract(pattern = "(?<=final/).*(?=\\.pdf)") %>% paste(collapse = ", ")
site_with_ecology
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>%
dplyr::pull(vegplotid) %>% unique()
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>%
dplyr::pull(vegplotiid) %>% unique()
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet)
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>%
dplyr::pull(vegplotid) %>% unique()
spreadsheet_with_plot_inv
View(my_veg_data$vegplotspecies)
View(my_veg_data$vegplotspecies %>% filter(vegplotid == "2015CA7925029"))
View(my_veg_data$vegplot %>% filter(vegplotid == "2015CA7925029"))
my_veg_data$vegplot$site_id
View(my_veg_data$vegplot %>% filter(site_id == "2015CA7925029"))
length(cathy) + length(julie_additional) + length(nate)
length(my_files_with_ecology)
length(unique(my_veg_data$vegplot$site_id))
library(soilDB)
library(dplyr)
library(aqp)
library(sf)
library(stringr)
library(ggplot2)
library(maps)
library(tibble)
my.components.MLRA <- fetchNASIS(from = "components", duplicates = T, dsn = "C:/Users/Nathan.Roe/Documents/ESS-FAQ/SQlite_tables/components18.sqlite", SS = FALSE)
MLRA18_ecosites <- my.components.MLRA$ecosite_id %>% str_subset(pattern = "18X") %>% unique()
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(comp_acreage))
}
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list) %>% remove_rownames()
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list
)
class(MLRA18_ecosite_acreage)
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(comp_acreage))
}
str(ecosite_list)
ecosite_list <- list()
for(i in names(MLRA18_ecosites)){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(comp_acreage))
}
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list) %>% remove_rownames()
names(MLRA18_ecosites)
MLRA18_ecosites
for(i in MLRA18_ecosites){
ecosite_list[[i]] <- aqp::site(my.components.MLRA) %>% dplyr::filter(ecosite_id == i) %>% select(ecosite_id, coiid, comppct_r, muacres) %>%
mutate(comp_acreage = (comppct_r/100)*muacres) %>% summarise(Ecosite = first(ecosite_id), Acreage =
sum(comp_acreage))
}
ecosite_list$R018XI163CA
MLRA18_ecosite_acreage <- do.call(rbind, ecosite_list) %>% remove_rownames()
head(MLRA18_ecosite_acreage)
# this is run with query for all of CA792
my_veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
# this is run with query for all of CA792
my_veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
unique(my_veg_data$vegplot$vegdataorigin)
head(my_veg_data$vegplot)
head(my_veg_data$vegplotspecies)
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs", full.names = TRUE,
recursive = TRUE) %>% stringr::str_subset(pattern = "(?<=/final/).*(?=\\.pdf)")
search_terms <- paste0(spreadsheet_with_plot_inv, collapse = "|")
table(my_veg_data$vegplot$vegdataorigin)
sites_with_site_existing <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "site existing veg table") %>% dplyr::pull(vegplotiid)
setdiff(sites_with_site_existing, my_veg_data_spreadsheet)
my_veg_data_spreadsheet <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(vegplotiid)
setdiff(sites_with_site_existing, my_veg_data_spreadsheet)
View(my_veg_data$vegplot)
View(my_veg_data$pl)
View(my_veg_data$vegplotspecies)
intersect(sites_with_site_existing, my_veg_data_spreadsheet)
length(nate)
library(dplyr)
library(stringr)
library(soilDB)
# this is run with query for all of CA792
my_veg_data <- fetchVegdata(dsn = "C:/Users/Nathan.Roe/Documents/SEKI/vegplotdata.sqlite", SS = FALSE)
my_veg_data_spreadsheet <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(vegplotiid)
spreadsheet_with_plot_inv <- my_veg_data$vegplotspecies %>% dplyr::filter(vegplotiid %in% my_veg_data_spreadsheet) %>%
dplyr::pull(vegplotid) %>% unique() # these are the vegplot ids that have a species inventory associated with a "spreadsheet form" entry - meaning
#                                       veg data collected by an ecologist
my_files <- list.files(path = "C:/Users/Nathan.Roe/Documents/SEKI/veg_pdfs", full.names = TRUE,
recursive = TRUE) %>% stringr::str_subset(pattern = "(?<=/final/).*(?=\\.pdf)")
search_terms <- paste0(spreadsheet_with_plot_inv, collapse = "|")
my_files_reduced <- my_files[!my_files %in% str_subset(my_files, pattern = search_terms)] # scanned PDFs of plots that DO NOT have species inventory from ecologist
my_files_with_ecology <- my_files[my_files %in% str_subset(my_files, pattern = search_terms)] # scanned PDFs of plots that DO have species inventory from ecologist
cathy <- my_files_reduced %>% stringr::str_subset(pattern = "7925")
julie <- my_files_reduced %>% stringr::str_subset(pattern = "(?<!2012CA|2013CA)7921")
julie_additional <- my_files_reduced %>% stringr::str_subset(pattern = "(?<=2012CA)7927") %>% c(julie)
nate <- my_files_reduced[!my_files_reduced %in% c(cathy, julie_additional)] %>% stringr::str_subset(pattern = "CA792")
length(nate)
length(julie_additional)
setdiff(sites_with_site_existing, my_veg_data_spreadsheet)
setdiff(sites_with_site_existing, my_veg_data_spreadsheet) %>% length()
setdiff(sites_with_site_existing, my_veg_data_spreadsheet) %>% length() %>% unique()
length(unique(sites_with_site_existing))
head(sites_with_site_existing)
head(my_veg_data_spreadsheet)
paste(sites_with_site_existing, collapse = ", ")
sites_with_site_existing <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "site existing veg table") %>% dplyr::pull(vegplot_id)
sites_with_spreadsheet <- my_veg_data$vegplot %>% dplyr::filter(vegdataorigin == "spreadsheet form") %>% dplyr::pull(vegplot_id)
setdiff(sites_with_site_existing, my_veg_data_spreadsheet) %>% length() %>% unique()
setdiff(sites_with_site_existing, my_veg_data_spreadsheet)
intersect(sites_with_site_existing, my_veg_data_spreadsheet)
paste(sites_with_site_existing, collapse = ", ")
View(head(my_veg_data$vegplotspecies))
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Marah")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Marah ")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Marah")
my_veg_data$vegplotspecies %>% filter(plantsciname == %in% stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Marah"))
my_veg_data$vegplotspecies %>% filter(plantsciname %in% stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Marah"))
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Torreya")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Chamaebatia")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Peritoma")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Isomeris")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Peritoma")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Ceanothus")
stringr::str_subset(my_veg_data$vegplotspecies$plantsciname, pattern = "Ceanothus") %>% unique()
